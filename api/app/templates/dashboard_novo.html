{% extends 'base.html' %}
{% block title %}Dashboard - Sistema de Est√°gios{% endblock %}
{% block content %}
<div class="dashboard-header">
  <h1>Dashboard</h1>
  <p class="welcome">Bem-vindo(a), {{ user.nome }}!</p>
</div>

<div class="metrics-grid">
  <div class="metric-card primary">
    <div class="metric-icon">üë•</div>
    <div class="metric-content">
      <h3>{{ total_estagios }}</h3>
      <p>Total de Est√°gios</p>
    </div>
  </div>
  
  <div class="metric-card success">
    <div class="metric-icon">‚úÖ</div>
    <div class="metric-content">
      <h3>{{ estagios_ativos }}</h3>
      <p>Est√°gios Ativos</p>
    </div>
  </div>
  
  <div class="metric-card warning">
    <div class="metric-icon">üë®‚Äç‚öïÔ∏è</div>
    <div class="metric-content">
      <h3>{{ total_supervisores }}</h3>
      <p>Supervisores</p>
    </div>
  </div>
  
  <div class="metric-card info">
    <div class="metric-icon">üè•</div>
    <div class="metric-content">
      <h3>{{ total_instituicoes }}</h3>
      <p>Institui√ß√µes</p>
    </div>
  </div>
</div>

<div class="dashboard-grid">
  <section class="card chart-card">
    <h2>Est√°gios por Territ√≥rio</h2>
    <div class="chart-container">
      <canvas id="territoriosChart" width="400" height="200"></canvas>
    </div>
  </section>
  
  <section class="card chart-card">
    <h2>Est√°gios por Curso</h2>
    <div class="chart-container">
      <canvas id="cursosChart" width="400" height="200"></canvas>
    </div>
  </section>
</div>

<div class="dashboard-grid">
  <section class="card">
    <h2>√öltimos Est√°gios Cadastrados</h2>
    <div class="recent-list">
      {% for estagio in ultimos_estagios %}
      <div class="recent-item">
        <div class="recent-avatar">{{ estagio.nome[0] }}</div>
        <div class="recent-info">
          <strong>{{ estagio.nome }}</strong>
          <span>{{ estagio.curso.nome if estagio.curso else 'Curso n√£o definido' }}</span>
          <small>{{ estagio.created_at.strftime('%d/%m/%Y') }}</small>
        </div>
        <div class="recent-actions">
          <a href="/relatorios/anexo2/{{ estagio.id }}?format=html" class="btn-small" target="_blank">Ver</a>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  
  <section class="card">
    <h2>A√ß√µes R√°pidas</h2>
    <div class="quick-actions">
      <a href="/web/estagios" class="action-btn">
        <span class="action-icon">‚ûï</span>
        <span>Novo Est√°gio</span>
      </a>
      <a href="/web/supervisores" class="action-btn">
        <span class="action-icon">üë®‚Äç‚öïÔ∏è</span>
        <span>Supervisores</span>
      </a>
      <a href="/web/catalogos" class="action-btn">
        <span class="action-icon">üìã</span>
        <span>Cat√°logos</span>
      </a>
      <a href="/web/relatorios" class="action-btn">
        <span class="action-icon">üìä</span>
        <span>Relat√≥rios</span>
      </a>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Gr√°fico de Territ√≥rios
const territoriosCtx = document.getElementById('territoriosChart').getContext('2d');
new Chart(territoriosCtx, {
    type: 'doughnut',
    data: {
        labels: {{ territorios_labels | safe }},
        datasets: [{
            data: {{ territorios_data | safe }},
            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6']
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: 'bottom' } }
    }
});

// Gr√°fico de Cursos
const cursosCtx = document.getElementById('cursosChart').getContext('2d');
new Chart(cursosCtx, {
    type: 'bar',
    data: {
        labels: {{ cursos_labels | safe }},
        datasets: [{
            label: 'Quantidade',
            data: {{ cursos_data | safe }},
            backgroundColor: '#3b82f6'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});
</script>
{% endblock %}